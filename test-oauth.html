<!DOCTYPE html>
<html>
<head>
    <title>OAuth Test</title>
</head>
<body>
    <h1>OAuth Test</h1>
    <button onclick="testOAuth()">Test Google OAuth</button>
    <div id="result"></div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        const supabase = window.supabase.createClient(
            'https://tfuhfrjokvmectwfrazm.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmdWhmcmpva3ZtZWN0d2ZyYXptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwNTE3NjUsImV4cCI6MjA3MDYyNzc2NX0.tYKnTxnKqEVm3mMqo-s6vx06dKPEJBziADgkXJuQ8Ng'
        )

        // Check for auth state on page load
        window.addEventListener('load', async () => {
            const { data: { session } } = await supabase.auth.getSession()
            if (session) {
                document.getElementById('result').innerHTML = `‚úÖ Authenticated as: ${session.user.email}`
            }
        })

        // Listen for auth state changes
        supabase.auth.onAuthStateChange((event, session) => {
            const result = document.getElementById('result')
            if (event === 'SIGNED_IN' && session) {
                result.innerHTML = `‚úÖ Successfully signed in: ${session.user.email}`
            } else if (event === 'SIGNED_OUT') {
                result.innerHTML = 'Signed out'
            }
        })

        async function testOAuth() {
            const result = document.getElementById('result')
            result.innerHTML = 'Initiating OAuth...'
            
            try {
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: `${window.location.origin}/auth/callback`
                    }
                })
                
                if (error) {
                    console.error('OAuth error:', error)
                    result.innerHTML = `‚ùå OAuth Error: ${error.message}`
                    return
                }
                
                if (!data?.url) {
                    result.innerHTML = '‚ùå No OAuth URL received'
                    return
                }
                
                result.innerHTML = 'üîÑ Redirecting to Google...'
                setTimeout(() => window.location.href = data.url, 1000)
                
            } catch (err) {
                console.error('OAuth exception:', err)
                result.innerHTML = `‚ùå Exception: ${err.message || 'Unknown error'}`
            }
        }
    </script>
</body>
</html>